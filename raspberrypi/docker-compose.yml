version: "3.3"
services:
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    ports:
      - '9000:9000'
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ~/applications/portainer-config:/data
    restart: always
  
  mariadb:
    image: mariadb:10.11.2
    container_name: mariadb
    ports:
      - '33060:3306'
    env_file: .env
    environment:
      MARIADB_ROOT_PASSWORD: password
    volumes:
      - ~/applications/mariadb-data:/var/lib/mysql
    restart: always

  pihole:
    image: pihole/pihole:latest
    container_name: pihole
    ports:
      - "5300:53/tcp"
      - "5300:53/udp"
      - "6700:67/udp"
      - "8000:80/tcp"
    env_file: .env
    environment:
      TZ: 'United Kingdom/London'    
    volumes:
      - '~/applications/pihole-data/etc-pihole:/etc/pihole'
      - '~/applications/pihole-data/etc-dnsmasq.d:/etc/dnsmasq.d'
    restart: always

  # TODO add hardware acceleration for these
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    ports:
      - '8097:8096'
      - '8921:8920'
    volumes:
        - ~/applications/jellyfin-data:/config
        - jellyfin-cache:/cache
    restart: always
  
  emby:
    image: emby/embyserver_arm64v8
    container_name: emby
    ports:
      - '8096:8096'
      - '8920:8920'
    environment:
      - UID=1000
      - GID=1000
    volumes:
      - ~/applications/emby-data:/config
    restart: always

volumes:
  jellyfin-cache: